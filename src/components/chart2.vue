<template>
  <div class="chart2">
      <section  id="chart2-background">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 520 925" style="enable-background:new 0 0 520 925;" xml:space="preserve">
        <g id="heat_x5F_island_x5F_chart1_x5F_background_x5F_mob">
          <rect x="432.23" y="170.25" class="st0" width="13.88" height="13"/>
          <rect x="344.43" y="170.25" class="st1" width="13.88" height="13"/>
          <g>
            <text transform="matrix(1.1186 0 0 1.0533 367.0459 183.7559)" class="st2 st3 st4">台北</text>
          </g>
          <g>
            <text transform="matrix(1.1186 0 0 1.0533 452.2881 183.7559)" class="st2 st3 st4">淡水</text>
          </g>
          <line class="st5" x1="47.56" y1="702.14" x2="488.06" y2="702.14"/>
          <line class="st5" x1="93.8" y1="227.18" x2="93.8" y2="713.35"/>
          <line class="st5" x1="151.73" y1="227.18" x2="151.73" y2="713.35"/>
          <line class="st5" x1="209.67" y1="227.18" x2="209.67" y2="713.35"/>
          <line class="st5" x1="260.67" y1="227.18" x2="260.67" y2="713.35"/>
          <line class="st5" x1="325.96" y1="227.18" x2="325.96" y2="713.35"/>
          <line class="st5" x1="383.9" y1="227.18" x2="383.9" y2="713.35"/>
          <line class="st5" x1="441.83" y1="227.18" x2="441.83" y2="713.35"/>
          <line class="st5" x1="487.93" y1="227.18" x2="487.93" y2="713.35"/>
          <g>
            <text transform="matrix(1.0052 0 0 1 15.9883 705.5752)" class="st0 st6 st7">20</text>
          </g>
          <g>
            <text transform="matrix(1.0052 0 0 1 15.9883 610.4854)" class="st0 st6 st7">21</text>
          </g>
          <g>
            <text transform="matrix(1.0052 0 0 1 15.9883 515.3965)" class="st0 st6 st7">22</text>
          </g>
          <g>
            <text transform="matrix(1.0052 0 0 1 15.9883 420.3096)" class="st0 st6 st7">23</text>
          </g>
          <g>
            <text transform="matrix(1.0052 0 0 1 15.9883 325.2188)" class="st0 st6 st7">24</text>
          </g>
          <g>
            <text transform="matrix(1.0052 0 0 1 15.9883 230.1338)" class="st0 st6 st7">25</text>
          </g>
          <line class="st5" x1="47.56" y1="713.38" x2="47.56" y2="226.67"/>
          <line class="st5" x1="42.77" y1="607.05" x2="488.06" y2="607.05"/>
          <line class="st5" x1="42.77" y1="511.97" x2="488.06" y2="511.97"/>
          <line class="st5" x1="42.77" y1="416.88" x2="488.06" y2="416.88"/>
          <line class="st5" x1="42.77" y1="321.79" x2="488.06" y2="321.79"/>
          <line class="st5" x1="42.77" y1="226.7" x2="488.06" y2="226.7"/>
          <g>
            <text transform="matrix(1.0052 0 0 1 39.0127 732.7783)" class="st0 st6 st7">1943</text>
          </g>
          <g>
            <text transform="matrix(1.0052 0 0 1 237.7031 732.7783)" class="st0 st6 st7">1980</text>
          </g>
          <g>
            <text transform="matrix(1.0052 0 0 1 358.2461 732.7783)" class="st0 st6 st7">2000</text>
          </g>
          <g>
            <text transform="matrix(1.0052 0 0 1 446.5576 732.7783)" class="st0 st6 st7">2018</text>
          </g>
          <g>
            <text transform="matrix(1.046 0 0 1 455.2686 763.1855)" class="st0 st3 st7">(年)</text>
          </g>
          <g>
            <text transform="matrix(1.046 0 0 1 10.2764 183.5859)" class="st0 st3 st4">(</text>
            <text transform="matrix(0.9494 0 0 1 21.1025 183.5859)" class="st0 st3 st4">℃</text>
            <text transform="matrix(1.046 0 0 1 40.7559 183.5859)" class="st0 st3 st4">)</text>
          </g>
          <g>
            <text transform="matrix(1.046 0 0 1 49.5508 185.0176)" class="st0 st3 st4">全年平均溫度</text>
          </g>
        </g>
        <g id="heat_x5F_island_x5F_chart1_x5F_taipei_x5F_mob">
          <polyline :class="lineOne" class="st8" points="54.82,506.11 60.74,474.44 66.66,533.7 72.16,457.07 78.08,533.7 84,485.68 89.5,484.65 
            95.42,536.76 106.84,473.42 113.18,467.29 118.68,442.76 124.17,535.74 130.09,509.18 135.59,512.24 141.51,481.59 147.43,462.18 
            153.35,473.42 158.85,459.11 164.77,515.31 170.69,513.26 176.19,458.09 182.11,487.72 188.03,443.79 193.53,498.96 199.02,532.68 
            204.94,515.31 210.87,501 216.36,499.98 222.28,503.05 228.2,463.2 233.7,491.81 239.62,482.61 245.54,499.98 251.04,428.46 
            256.96,478.52 262.88,499.98 268.38,467.29 273.87,467.29 279.8,470.35 285.72,446.85 292.06,517.35 297.56,455.02 303.48,473.42 
            308.97,414.16 314.47,412.11 320.39,411.09 325.89,369.2 331.81,369.2 337.73,483.63 343.65,446.85 349.15,400.87 355.07,480.57 
            360.57,466.26 366.91,462.18 372.41,367.16 377.9,417.22 383.82,396.79 389.74,386.57 395.24,340.59 407.08,408.02 413,391.68 
            418.5,342.63 424.42,363.07 429.92,401.89 435.84,375.33 441.34,392.7 447.26,439.7 453.18,399.85 458.67,381.46 464.59,371.24 
            470.52,343.66 476.01,325.26 481.93,333.44 487.85,331.4 	"/>
        </g>
        <g id="heat_x5F_island_x5F_chart1_x5F_tamsui_x5F_mob">
          <polyline :class="lineTwo" class="st9" points="55.24,501 61.16,505.09 66.24,536.76 72.16,450.94 78.08,525.52 84,475.46 89.5,474.44 95.42,522.46 
            106.84,467.29 112.76,472.39 118.25,443.79 124.17,520.42 130.09,499.98 135.59,503.05 141.51,478.52 147.43,460.13 152.93,459.11 
            158.43,446.85 164.77,515.31 170.27,509.18 176.19,474.44 181.69,491.81 187.18,466.26 193.53,510.2 199.45,539.83 204.94,534.72 
            210.87,513.26 216.36,507.13 222.28,515.31 228.2,480.57 234.12,509.18 239.62,504.07 245.54,523.48 251.04,445.83 256.96,495.89 
            262.88,498.96 268.8,458.09 274.3,462.18 279.8,471.37 285.72,448.89 291.64,515.31 297.13,514.28 303.05,554.13 308.97,520.42 
            314.47,539.83 320.39,519.39 326.31,490.78 331.81,486.7 337.73,564.35 343.65,498.96 349.15,482.61 355.07,548 360.57,548 
            366.49,527.57 372.41,462.18 378.33,481.59 383.82,471.37 389.74,481.59 395.24,449.92 401.16,476.48 407.08,511.22 412.58,515.31 
            418.5,461.15 424.42,465.24 429.92,481.59 435.84,449.92 441.34,485.68 447.26,541.87 453.18,504.07 458.67,446.85 464.59,439.7 
            470.09,410.07 476.01,421.31 481.93,401.89 487.85,413.13 	"/>
        </g>
        <g :class="{'current_group': steps[1] }" class="first_group" id="heat_x5F_island_x5F_chart1_x5F_1985_x5F_mob">
          <circle class="st1" cx="297.65" cy="453.49" r="4.83"/>
          <circle class="st0" cx="297.65" cy="514.21" r="4.83"/>
          <g>
            <text transform="matrix(1.1018 0 0 1 252.1016 421.479)" class="st1 st10 st11">22.6</text>
          </g>
          <g>
            <text transform="matrix(1.1018 0 0 1 250.1016 544.3384)" class="st0 st10 st11">22.0</text>
          </g>
        </g>
        <g id="heat_x5F_island_x5F_chart1_x5F_1985line_x5F_mob">
          <g>
            <g>
              <line class="st12" x1="296.92" y1="227.18" x2="296.92" y2="229.68"/>
              <line class="st13" x1="296.92" y1="232.72" x2="296.92" y2="247.41"/>
              <line class="st14 line_move" x1="296.92" y1="248.93" x2="296.92" y2="709.5"/>
              <line class="st12" x1="296.92" y1="711.02" x2="296.92" y2="713.52"/>
            </g>
          </g>
        </g>
        <g :class="groupTwo" class="sec_group" id="heat_x5F_island_x5F_chart1_x5F_2018_x5F_mob">
          <g>
            <text transform="matrix(1.1018 0 0 1 460.6094 318.2119)" class="st1 st10 st7">23.9</text>
          </g>
          <circle class="st1" cx="489.45" cy="332.64" r="4.83"/>
          <circle class="st0" cx="489.87" cy="415.4" r="4.83"/>
          <text transform="matrix(1.046 0 0 1 463.0049 401.0117)" class="st0 st10 st7">23.0</text>
        </g>
        <g id="heat_x5F_island_x5F_chart1_x5F_dot_x5F_mob">
          <circle class="st1" cx="260.55" cy="702.18" r="4.83"/>
        </g>
        <g id="heat_x5F_island_x5F_chart1_x5F_line_x5F_mob">
          <g>
            <g>
              <line class="st12" x1="260.55" y1="227.18" x2="260.55" y2="229.68"/>
              <line class="st13" x1="260.55" y1="232.72" x2="260.55" y2="247.41"/>
              <line class="st14" x1="260.55" y1="248.93" x2="260.55" y2="709.5"/>
              <line class="st12" x1="260.55" y1="711.02" x2="260.55" y2="713.52"/>
            </g>
          </g>
        </g>
        <g :class="{'current_group': steps[3] }" class="third_group" id="heat_x5F_island_x5F_chart1_x5F_1980_x5F_mob">
          <g>
            <text transform="matrix(1.1018 0 0 1 239.1152 547.6455)" class="st1 st10 st11">22.5</text>
          </g>
          <circle class="st1" cx="260.92" cy="501.07" r="4.83"/>
          <circle class="st0" cx="260.92" cy="493.83" r="4.83"/>
          <text transform="matrix(1.046 0 0 1 240.2539 420.4443)" class="st0 st10 st11">22.6</text>
        </g>
        <g :class="{'current_group': steps[4] }" class="forth_group" id="heat_x5F_island_x5F_chart1_x5F_1986_x5F_mob">
          <g>
            <text transform="matrix(1.1018 0 0 1 252.8945 431.4736)" class="st1 st10 st11">22.4</text>
          </g>
          <circle class="st1" cx="303.41" cy="474.9" r="4.83"/>
          <circle class="st0" cx="302.84" cy="553.66" r="4.83"/>
          <text transform="matrix(1.046 0 0 1 250.1719 558.2734)" class="st0 st10 st11">21.6</text>
        </g>
        <g :class="groupFive" class="five_group" id="heat_x5F_island_x5F_chart1_x5F_1987_x5F_mob">
          <g>
            <text transform="matrix(1.1018 0 0 1 269.1221 396.4561)" class="st1 st10 st11">23.0</text>
          </g>
          <circle class="st1" cx="309.64" cy="413.88" r="4.83"/>
          <circle class="st0" cx="309.06" cy="522.64" r="4.83"/>
          <text transform="matrix(1.046 0 0 1 271.3994 586.2559)" class="st0 st10 st11">21.9</text>
        </g>
        </svg>
      </section>
      <div class="section section1">
        <div class="container">
          <div ref="chart-content1" class="chart-content chart-content1">
            <p>台北、淡水氣象站的氣溫早期十分接近。</p>
          </div>
        </div>  
      </div>
      <div class="section section2">
        <div class="container">
          <div ref="chart-content2" class="chart-content chart-content2">
            <p>但自1985年起，兩站氣溫差距增至 <span class="mark">0.7度</span>，到了2018年已經<span class="mark">超過1度</span>。</p>
            <br>
            <p>推究其因，1985年前後是台北氣象站周邊地表環境改變最大的時刻。</p>
          </div>
        </div>   
      </div>
      <div class="section section3">
        <div class="container">
          <div ref="chart-content3" class="chart-content chart-content3">
            <p>但自1985年起，兩站氣溫差距增至 <span class="mark">0.7度</span>，到了2018年已經<span class="mark">超過1度</span>。</p>
            <br>
            <p>推究其因，1985年前後是台北氣象站周邊地表環境改變最大的時刻。</p>
          </div>
        </div>   
      </div>
      <div class="section section4">
        <div class="container">
          <div ref="chart-content4" class="chart-content chart-content4">
            <p>但自1985年起，兩站氣溫差距增至 <span class="mark">0.7度</span>，到了2018年已經<span class="mark">超過1度</span>。</p>
            <br>
            <p>推究其因，1985年前後是台北氣象站周邊地表環境改變最大的時刻。</p>
          </div>
        </div>   
      </div>
      <div class="section section5">
        <div class="container">
          <div ref="chart-content5" class="chart-content chart-content5">
            <p>但自1985年起，兩站氣溫差距增至 <span class="mark">0.7度</span>，到了2018年已經<span class="mark">超過1度</span>。</p>
            <br>
            <p>推究其因，1985年前後是台北氣象站周邊地表環境改變最大的時刻。</p>
          </div>
        </div>   
      </div>
      <div class="section section6">
        <div class="container">
          <div ref="chart-content6" class="chart-content chart-content6">
            <p>但自1985年起，兩站氣溫差距增至 <span class="mark">0.7度</span>，到了2018年已經<span class="mark">超過1度</span>。</p>
            <br>
            <p>推究其因，1985年前後是台北氣象站周邊地表環境改變最大的時刻。</p>
          </div>
        </div>   
      </div>

  </div>
</template>

<script>
import ScrollMagic from 'scrollmagic'
import { setTimeout } from 'timers';
import myMixin from '../mixin/myMixin.js'

export default {
  name: 'chart2',
  data () {
    return {
      currentStep: 0,
      steps: [true, false, false, false, false, false, false]
    }
  },
  props: {
    msg: String
  },
  mixins: [myMixin],
  mounted () {

    let vm = this
    // var w = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
    // var h = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);

    window.addEventListener('scroll', this.handleScroll)

    var controller = new ScrollMagic.Controller();
    var scene1 = new ScrollMagic.Scene({triggerElement: "#chart2-background", duration: '600%', triggerHook: 'onLeave'})
                    .setPin("#chart2-background", {pushFollowers: false})
                    .addTo(controller);

    
  },
  methods: {
    handleScroll () {
      if(this.isElementInViewport(this.$refs['chart-content1'])) {
        this.currentStep = 1
      } else if(this.isElementInViewport(this.$refs['chart-content2'])) {
        this.currentStep = 2
      } else if(this.isElementInViewport(this.$refs['chart-content3'])) {
        this.currentStep = 3
      } else if(this.isElementInViewport(this.$refs['chart-content4'])) {
        this.currentStep = 4
      } else if(this.isElementInViewport(this.$refs['chart-content5'])) {
        this.currentStep = 5
      } else if(this.isElementInViewport(this.$refs['chart-content6'])) {
        this.currentStep = 6
      } else {
        this.currentStep = 0
      }
      this.steps.fill(false)
      this.steps[this.currentStep] = true
    }
  },
  computed: {
    lineOne () {
      return {
        'line_one_default': (this.currentStep == 0) ? true: false,
        'line_one_step1': (this.currentStep == 1) ? true: false,
        'line_one_step2': (this.currentStep == 2) ? true: false,
        'line_one_other_step': (this.currentStep == 3) || (this.currentStep == 4) || (this.currentStep == 5) || (this.currentStep == 6) ? true: false
      }
    },
    lineTwo () {
      return {
        'line_two_default': (this.currentStep == 0) ? true: false,
        'line_two_step1': (this.currentStep == 1) ? true: false,
        'line_two_step2': (this.currentStep == 2) ? true: false,
        'line_two_other_step': (this.currentStep == 3) || (this.currentStep == 4) || (this.currentStep == 5) || (this.currentStep == 6) ? true: false
      }
    },
    groupTwo () {
      return {
        'current_group': (this.currentStep == 0 ) || (this.currentStep == 1) ? false : true
      }
    },
    groupFive () {
      return {
        'current_group': (this.currentStep == 5) || (this.currentStep == 6) ? true: false
      }
    }
  }
}
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped lang="scss">
.chart2 {
  z-index: 100;
  background-color: white;
  //.st8 主要線
  //.st9 次要線
  #chart2-background {
    .st0{fill:#707070;}
    .st1{fill:#EA0303;}
    .st2{fill:#605F5F;}
    .st3{font-family:'ARHeiB5-Light-B5pc-H';}
    .st4{font-size:20.7px;}
    .st5{fill:none;stroke:#969696;stroke-width:0.25;stroke-miterlimit:10;}
    .st6{font-family:'ArialMT';}
    .st7{font-size:22.08px;}
    .st8{
      fill:none;
      stroke:#EA0303;
      stroke-width:1.5;
      stroke-miterlimit:10;
      stroke-dasharray: 2520;
      // animation: red 5s linear infinite;
    }
    .st9{
      fill:none;
      stroke:#707070;
      stroke-width:1.5;
      stroke-miterlimit:10;
      stroke-dasharray: 2520;
      // animation: gray 5s linear infinite;
    }
    .st10{font-family:'Arial-BoldMT';}
    .st11{font-size:21px;}
    .st12{fill:none;stroke:#EA0303;stroke-width:0.25;stroke-miterlimit:10;}
    .st13{fill:none;stroke:#EA0303;stroke-width:0.25;stroke-miterlimit:10;stroke-dasharray:5.0668,3.0401,5.0668,3.0401;}
    .st14{fill:none;stroke:#EA0303;stroke-width:0.25;stroke-miterlimit:10;stroke-dasharray:5.0668,3.0401,5.0668,3.0401,5.0668,3.0401;}
    .line_one_default {
      stroke-dashoffset: 2520;
    }
    .line_one_step1 {
      animation: redOne 1s linear forwards;
    }
    .line_one_step2 {
      animation: redTwo 1s linear forwards;
    }
    .line_one_other_step {
      stroke-dashoffset: 0;
    }
    .line_two_default {
      stroke-dashoffset: 2520;
    }
    .line_two_step1 {
      animation: grayOne 1s linear forwards;
    }
    .line_two_step2 {
      animation: grayTwo 1s linear forwards;
    }
    .line_two_other_step {
      stroke-dashoffset: 0;
    }
    @keyframes redOne {
      from {
        stroke-dashoffset: 2520;
      }
      to {
        stroke-dashoffset: 1090;
      }
    }
    @keyframes redTwo {
      from {
        stroke-dashoffset: 1015;
      }
      to {
        stroke-dashoffset: 0;
      }
    }
    @keyframes grayOne {
      from {
        stroke-dashoffset: 2520;
      }
      to {
        stroke-dashoffset: 1290;
      }
    }
    @keyframes grayTwo {
      from {
        stroke-dashoffset: 1250;
      }
      to {
        stroke-dashoffset: 0;
      }
    }
    .first_group, .sec_group, .third_group, .forth_group, .five_group {
      opacity: 0;
    }
    .current_group {
      opacity: 1;
      transition: all 1s ease-out;
      transition-delay: 0.5s;
    }
    .line_move {
      transform: translateX(-7%)
    }
  }
  .section {  
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: white;
      .chart-content {
        background-color: white;
        position: relative;
        z-index: 100;
      }
  }
}

</style>